{
    "contents" : "---\ntitle: \"Going Beyond RFM - CLV Prediction\"\nauthor: \"Ashish Kulkarni\"\ndate: \"Wednesday, April 08, 2015\"\noutput: ioslides_presentation\n---\n\n## CLV Prediction using RFM\n\nAssumes monetary value to be independent of the underlying transaction process.\n\n$$CLV = margin \\times revenue/transaction \\times DET$$\n\nwhere, DET (Discounted Expected Transactions) is the present value of the future transaction flow.\n\nNext, we develop separate submodels to predict DET and expected revenue per transaction.\n\n## Submodel for DET prediction - The Pareto/NBD Model\n\n<small>\nBased on five assuptions:\n\n- While active, the number of transactions made by a user in a time period $t$ follows a Poisson distribution with transaction rate $\\lambda$.\n- Heterogeneity in transaction rates across users follows a gamma distribution with shape parameter $r$ and scale parameter $\\alpha$.\n- Each user has an unobserved ``lifetime'' $\\tau$. This point at which the user churns is distributed exponentially with dropout rate $\\mu$.\n- The prior on dropout rate follows a gamma distribution with shape parameter $s$ and scale parameter $\\beta$.\n- The transaction rate $\\lambda$ and dropout rate $\\mu$ vary independently across customers.\n</small>\n\n## Notations\n\n<small>\nRequires only two pieces of input about each user's past purchasing history:\n\n- recency: time from now of occurrence of last transaction\n- frequency: number of transactions made during a specified time period\n\nThis is expressed using the notation $(X = x, t_x, T)$, where $x$ is the number of observed transactions in the time period $(0, T]$ and $t_x (0 < t_x \\leq T)$, is the time of last transaction.\n\n$$DET(\\delta|r,\\alpha,s,\\beta,X=x,t_x,T) = \\frac{\\alpha^r\\beta^s\\delta^{s-1}\\Gamma(r+x+1)\\Psi[s,s;\\delta(\\beta+T)]}{\\Gamma(r)(\\alpha+T)^{r+x+1}L(r,\\alpha,s,\\beta|X=x,t_x,T)}$$\nwhere, $r,\\alpha,s,\\beta$ are the model parameters, $\\Psi(.)$ is the confluent hypergeometric function of the second kind; and $L(.)$ is the Pareto/NBD likelihood function.\n</small>\n\n## Comments about Pareto/NBD Model\n\n<small>\n\n- The Pareto/NBD model does quite well in modeling the user behavior.\n- The emperical performance of the model is excellent and well proven. However, the model suffers from the following drawbacks.\n- The likelihood function associated with the Pareto/NBD model is quite complex, involving numerous evaluations of the Gaussian hypergeometric function.\n- Multiple evaluations of the Gaussian hypergeometric function are compuatationally intensive.\n</small>\n\n## Submodel DET Prediction - BG/NBD Model\n\n<small>\nBased on following five assumptions:\n\n- While active, the numbre of transactions made by a user follows a Poisson distribution with transaction rate $\\lambda$.\n- Heterogeneity in $\\lambda$ follows a gamma distribution with shape parameter $r$ and scale parameter $\\alpha$.\n- After any transaction, a user becomes inactive with probability $p$, so, $P$(inactive immediately after $j^{th}$ transaction) $= p(1-p)^{j-1}, j = 1,2,3,...$.\n- Heterogeneity in $p$ follows a beta distribution, $p \\sim Beta(a,b)$.\n- The transaction rate $\\lambda$ and churn probability $p$ vary independently across users.\n</small>\n\n## Model Development\n\n<small>\nLikelihood function for a randomly chosen user with purchase history $(X=x,t_x,T)$\n$$\n  \\begin{aligned}\n  L(r,\\alpha,a,b|X=x,t_x,T) &= \\frac{B(a,b+x)}{B(a,b)}\\frac{\\Gamma(r+x)\\alpha^r}{\\Gamma(r)(\\alpha+T)^{r+x}} \\\\ \n  &+ \\delta_{x>0}\\frac{B(a+1,b+x-1)}{B(a,b)}\\frac{\\Gamma(r+x)\\alpha^r}{\\Gamma(r)(\\alpha+t_x)^{r+x}}\n  \\end{aligned}\n$$\nThe model parameters can be estimated using maximum likelihood estimation. For a sample of $N$ users, where user $i$ had $X_i=x_i$ transactions in the period $(0,T_i]$, with recency $t_{x_i}$, the sample log likelihood is given as:\n$$LL(r,\\alpha,a,b) = \\sum_{i=1}^N ln[L(r,\\alpha,a,b|X_i=x_i,t_{x_i},T_i)]$$\nThis can be maximized using standard numerical optimization routines\n</small>\n\n## Expression for DET prediction\n\n<small>\n$$\n  \\begin{aligned}\n  E[Y(t)|X &= x,t_x,T,r,\\alpha,a,b] = \\\\\n   &\\frac{\\frac{a+b+x-1}{a-1}[1-(\\frac{\\alpha+T}{\\alpha+T+t})^{r+x} {}_{2}F_{1}(r+x,b+x;a+b+x-1;\\frac{t}{\\alpha+T+t})]}{1+\\delta_{x>0}\\frac{a}{b+x-1}(\\frac{\\alpha+T}{\\alpha+t_x})^{r+x}}\n  \\end{aligned}\n$$\n\n- Requires single evaluation of the Gaussian hypergeometric function for any user. Remainder of the expression is simple arithmetic.\n- Thus compared to Pareto/NBD, BG/NBD is computationally efficient.\n- Performance of this model is almost at-par with the Pareto/NBD model.\n</small>\n\n## Submodel for Monetary Value Prediction : Gamma-Gamma Model\n\n<small>\n\n- The amount of a user's transaction varies randomly around his/her average transaction value. For a given user with $x$ transactions, if $z_1, ..., z_x$ denote the dollar value of each transaction, then the observed average value is $m_x = \\sum_{i=1}^xz_i/x$. Our goal is to infer $E(M)$, the (unobserved) population mean transaction value.\n- We assume that the $z_i$ are i.i.d. gamma variables with shape parameter $p$ and scale parameter $\\nu$.\n- To account for heterogeneity in the underlying mean transaction values across customers, we assume a gamma prior on $\\nu$, so that, $\\nu\\sim\\Gamma(q, \\gamma)$\n- It can be shown that,\n$$\n  \\begin{aligned}\n  E(M|p,q,\\gamma,m_x,x) = \\Big(\\frac{q-1}{px+q-1}\\Big)\\frac{\\gamma p}{q-1} + \\Big(\\frac{px}{px+q-1}\\Big)m_x.\n  \\end{aligned}\n$$\n</small>\n",
    "created" : 1428476386194.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "141923240",
    "id" : "851C942C",
    "lastKnownWriteTime" : 1428477046,
    "path" : "C:/Users/akulkarni/RWorkspace/rfm/clv.Rmd",
    "project_path" : "clv.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}